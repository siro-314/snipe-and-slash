# SNIPE & SLASH 開発日記

## プロジェクト概要
**開始日**: 2025年12月中旬  
**現在のステータス**: デプロイ完了・運用中  
**本番URL**: https://playful-concha-6af59f.netlify.app  
**GitHub**: https://github.com/siro-314/snipe-and-slash

ブラウザで遊べる無料VRシューティング「SNIPE & SLASH」の開発記録。
ターゲットは子供・VRCユーザー等のライトユーザー層。スプラトゥーン的なポップで明るいビジュアルを目指す。

---

## 2025年12月中旬: プロジェクト始動

### 技術選定フェーズ
- **WebXR対応**: Unity WebGLではなくA-Frameを選択
  - 理由: 軽量、ブラウザ即起動、VRコントローラー操作が簡単
- **デプロイ先**: Netlify（GitHub連携で自動デプロイ）
- **収益化戦略**: 初期は無料公開、後からheyVR等で広告SDK組み込み

### 初期実装
- VRリグ（A-Frame movement-controls）
- 基本的な剣攻撃システム
- 敵の白ドローン（球体）実装
- HUD表示（キル数・被弾数・時間）

---

## 2025年12月下旬: コア機能の実装

### 武器システムの拡張
- **剣⇔弓の切り替え機構**
  - トリガー操作: 剣 → 弓切替 → 射撃 → 剣復帰
  - グリップ: 弓の弦引き演出
- **物理判定の改善**
  - 初期: 単純な距離計算
  - 改良: Box3（バウンディングボックス）による高精度接触判定

### 敵AIの実装
- **白ドローン**: プレイヤー追尾 + 射撃
- **黒ドローン**: カクカク移動 → タメ → 爆発
- **enemy-aiコンポーネント**: 敵タイプごとに振る舞いを定義

### 判定バグとの戦い
- **問題**: 敵が即死する、または判定が効かない
- **原因**: ゲーム開始直後の巨大判定ボックス
- **解決策**:
  1. 判定有効化を3秒遅延
  2. 異常に大きいBox3を無視するロジック追加

---

## 2026年1月上旬: GLBモデル導入

### Blenderで3Dモデル作成
- **sword.glb**: 剣⇔弓変形ギミック
  - パーツ構成: 上ブレード・下ブレード・弦・矢
  - Blender座標系 → Three.js座標系の回転修正（X90, Y90, Z180）
- **drone_white.glb / drone_black.glb**: 敵ドローンモデル

### ModelManagerの実装
- **疎結合設計**: GLBロード処理を独立モジュール化
- **フォールバック機構**: ロード失敗時は自動的にBox/Sphereで代替表示
- **エラーハンドリング**: 詳細ログ出力、デバッグ容易化

---

## 2026年1月中旬: ステージ＆UI改善

### ビジュアル強化
- **背景色**: 水色 → マゼンタ（#ff00ff）に変更
  - 理由: よりポップで印象的、スプラトゥーン的
- **宇宙船風ステージ**: 水色グリッドの床を追加

### スタート画面実装
- タイトル表示: "⚔️ SNIPE & SLASH 🏹"
- 操作説明
- STARTボタン

### クリア画面
- スコア計算: キル数×100 - 被弾×50 - 時間×2
- リトライボタン

---

## 2026年1月下旬: デバッグ＆最適化

### コードリファクタリング
- **GameState**: グローバル状態管理の明確化
- **コンポーネント分離**:
  - `sword`: 武器制御
  - `enemy-ai`: 敵AI
  - `bullet`: 弾丸物理
  - `weapon-controller`: VRコントローラー入力処理

### Quest対応テスト
- Questブラウザで動作確認
- パフォーマンス問題なし

---

## 2026年1月31日: Netlifyデプロイ完了

### 本番環境公開
- **URL**: https://playful-concha-6af59f.netlify.app
- **GitHub連携**: 自動デプロイ設定完了
- **動作確認**: PC/Quest両方でテスト → OK

---

## 2026年2月10日: Geminiでの失敗とClaudeへの回帰

### Antigravityでのトラブル
- **やりたかったこと**: 新機能追加やコード改善
- **問題**: Geminiが上手くコーディングできず、期待した成果が得られなかった
- **決断**: Claudeに戻ることを決意

### コード品質の再評価（by Claude）
- **疎結合**: ✅ ModelManager・GameState・コンポーネント分離
- **堅牢性**: ✅ エラーハンドリング、フォールバック機構
- **拡張性**: ✅ コンポーネントベース、武器追加が容易
- **可読性**: ✅ 1249行でも明確なセクション分け
- **改善余地**: 大型化時にファイル分割検討

### 開発日記システムの構築
- **引き継ぎファイル**: Claude用の技術仕様書（`snipe-slash-progress.md`）
- **開発日記**: 人間が読む年表（このファイル）
- **目的**: プロジェクトの歴史を残し、次のAI支援でも文脈を失わない

---

## 今後の展望

### 短期目標（1〜2週間）
1. 弓のGLBモデル改善（変形アニメーション）
2. 敵のバリエーション追加（タレット、ボス等）
3. ゲームバランス調整

### 中期目標（1〜2ヶ月）
1. 広告SDK組み込み（heyVR等）
2. ステージ追加（複数マップ）
3. マルチプレイヤー対応検討

### 長期目標（3ヶ月〜）
1. ユーザーフィードバック収集
2. 継続的なコンテンツ追加
3. コミュニティ形成

---

## 技術的な学び

### A-Frameの良さ
- **WebXR対応が超簡単**: `<a-scene>`だけでVR対応完了
- **コンポーネントシステム**: 再利用可能な機能を簡単に作れる
- **Three.js直接操作可能**: 低レベルな制御も可能

### 疎結合設計の重要性
- **ModelManager**: GLBロードを独立させたことで、エラーハンドリングが容易に
- **GameState**: グローバル状態を1箇所に集約したことで、デバッグが楽
- **コンポーネント**: 機能ごとに分離したことで、拡張が容易

### Blender→Three.js座標系の罠
- **問題**: Blenderでモデルを作ってインポートすると回転がおかしい
- **解決**: `rotation.set(Math.PI/2, Math.PI/2, Math.PI)` で修正
- **学び**: 座標系の違いは事前に理解しておくべき

---

## 振り返り

### うまくいったこと
- ✅ 初期からNetlifyデプロイを前提にしたことで、テストが容易
- ✅ フォールバック機構を最初から組み込んだことで、デバッグが楽
- ✅ コンポーネント設計で拡張性を確保

### 苦労したこと
- ⚠️ 剣の当たり判定バグ（3秒ディレイで解決）
- ⚠️ Blender座標系の変換（試行錯誤が必要だった）
- ⚠️ Geminiでのコーディング失敗（Claude回帰）

### 次に活かしたいこと
- 💡 最初からファイル分割を検討（1000行超えたらリファクタリング）
- 💡 テストプレイの頻度を上げる（バグ早期発見）
- 💡 AI支援は使い分ける（Claudeの強みを活かす）

---

**最終更新**: 2026-02-10  
**総開発期間**: 約2ヶ月  
**コード行数**: 1249行（game.js）  
**ステータス**: 運用中・継続開発
